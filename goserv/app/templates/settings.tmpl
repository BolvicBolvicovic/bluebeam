<html>
  <head>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="flex items-center justify-center min-h-screen bg-gray-100">
    <div class="w-full max-w-md p-6 bg-white rounded-lg shadow-md">
      <!-- Webextension Name -->
      <h1 class="text-3xl font-bold text-blue-600 text-center mb-6 lowercase">bluebeam</h1>

      <!-- Header Section -->
      <h1 class="text-2xl font-bold text-blue-600 text-center mb-4">VÃ¤lkommen, {{ .username }}</h1>

      <!-- File Upload Form -->
      <form class="upload space-y-4" onsubmit="sendCriterias(event)">
        <label for="criterias" class="block w-full py-2 px-4 text-center bg-blue-50 text-blue-600 border border-blue-300 rounded-lg cursor-pointer hover:bg-blue-100 transition">
          Choose JSON criteria file
        </label>
        <input type="file" name="criterias" id="criterias" accept=".json" required class="hidden" onchange="showFileSelected()" />

        <button 
          type="submit" 
          class="w-full py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition">
          Submit JSON criteria file
        </button>

        <!-- Notification Message -->
        <div id="fileStatus" class="text-center mt-2"></div>
      </form>

      <button
          class="w-full py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition">
          Submit Google Spreadsheet criteria
      </button>

      <!-- Email Update Form -->
      <form class="update-email space-y-4 mt-6" onsubmit="updateEmail(event)">
        <input type="email" id="email" name="email" placeholder="Enter new email" required class="w-full py-2 px-4 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" />

        <button type="submit" class="w-full py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition">
          Update Email
        </button>

        <!-- Notification Message -->
        <div id="emailStatus" class="text-center mt-2"></div>
      </form>
    </div>

    <script>
      function showFileSelected() {
        const fileStatus = document.getElementById("fileStatus");
        const fileInput = document.getElementById("criterias");

        if (fileInput.files.length > 0) {
          fileStatus.textContent = "File selected: " + fileInput.files[0].name;
          fileStatus.classList.remove("text-blue-800");
          fileStatus.classList.add("text-blue-400");
        } else {
          fileStatus.textContent = "";
        }
      }

      function sendCriterias(event) {
        event.preventDefault();
        const file = document.getElementById("criterias").files[0];
        const fileStatus = document.getElementById("fileStatus");

        if (!file) {
          fileStatus.textContent = "Please select a file before submitting.";
          fileStatus.classList.remove("text-blue-400");
          fileStatus.classList.add("text-blue-800");
          return;
        }

        const reader = new FileReader();
        reader.onload = function() {
          const features = JSON.parse(reader.result);

          fetch('https://localhost/criterias', {
            method: 'POST',
            mode: 'cors',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              username: "{{ .username }}",
              sessionkey: "{{ .sessionkey }}",
              features: features
            }),
          })
          .then(response => response.text())
          .then(data => {
            fileStatus.textContent = "Criteria successfully submitted!";
            fileStatus.classList.remove("text-blue-800");
            fileStatus.classList.add("text-blue-400");
          })
          .catch(error => {
            console.error('Error sending data:', error);
            fileStatus.textContent = "Error submitting criteria.";
            fileStatus.classList.remove("text-blue-400");
            fileStatus.classList.add("text-blue-800");
          });
        }

        reader.readAsText(file);
      }

      function updateEmail(event) {
        event.preventDefault();
        const email = document.getElementById("email").value;
        const emailStatus = document.getElementById("emailStatus");

        fetch('https://localhost/updateEmail', {
          method: 'POST',
          mode: 'cors',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            username: "{{ .username }}",
            sessionkey: "{{ .sessionkey }}",
            email: email
          }),
        })
        .then(response => response.text())
        .then(data => {
          emailStatus.textContent = "Email updated successfully!";
          emailStatus.classList.remove("text-blue-800");
          emailStatus.classList.add("text-blue-400");
        })
        .catch(error => {
          console.error('Error updating email:', error);
          emailStatus.textContent = "Error updating email.";
          emailStatus.classList.remove("text-blue-400");
          emailStatus.classList.add("text-blue-800");
        });
      }
    </script>
  </body>
</html>
